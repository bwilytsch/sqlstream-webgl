"use strict";function WebGL(){function e(){a.createLandscape(),a.animate(),a.bindEventListeneres()}var t,a=this;this.defaultParams={width:window.innerWidth,height:window.innerHeight,container:"#webgl-container",models:{landscape:"./models/landscape.json"},torus:{color:"#AAAAAA",color1:"#00cea0",color2:"#fd8925",model:{},initVertices:[],centroid:new THREE.Vector3,height:.04,frequency:100,amplifier:2,radius:.8,thickness:.13,radialSegments:96,tubularSegments:96,distance:-2.4},landscape:{model:{},initVertices:[],dots:[],dotsAmount:320,animate:!1},renderer:{alpha:!0,antialias:!0}},this.Utils={onWindowResize:function(){a._WIDTH=window.innerWidth,a._HEIGHT=window.innerHeight,a._CAMERA.aspect=a._WIDTH/a._HEIGHT,a._CAMERA.updateProjectionMatrix(),a._RENDERER.setSize(a._WIDTH,a._HEIGHT)},checkValue:function(e,t){var a;return a=0>=e?e-t:e+t},calcSin:function(e,t){var o=e+Math.sin(t*a.torus.height);return o}},this.config=function(o){var r=o.container||a.defaultParmas.container,s=o.renderer||a.defaultParmas.renderer;a.torus=this.defaultParams.torus,a.torus.color=o.torus.color,a.torus.color1=o.torus.color1,a.torus.color2=o.torus.color2,a.torus.height=o.torus.height,a.torus.frequency=o.torus.frequency,a.torus.amplifier=o.torus.amplifier,a.torus.radius=o.torus.radius,a.torus.thickness=o.torus.thickness,a.torus.radialSegments=o.torus.radialSegments,a.torus.tubularSegments=o.torus.tubularSegments,a.torus.tubularSegments=o.torus.tubularSegments,a.landscape=a.defaultParams.landscape,a.landscape.dotsAmount=o.landscape.dotsAmount,a.landscape.animate=o.landscape.animate,t=new Stats,t.showPanel(0),t.domElement.style.position="absolute",t.domElement.style.top=0,document.body.appendChild(t.domElement),this._WIDTH=o.width||a.defaultParmas.width,this._HEIGHT=o.height||a.defaultParmas.height,this._CONTAINER=document.querySelector(r),this.isChanging=!1,this._RENDERER=new THREE.WebGLRenderer({alpha:s.alpha,antialias:s.antialias}),this._RENDERER.setSize(this._WIDTH,this._HEIGHT),this._RENDERER.getPixelRatio(window.devicePixelRatio||1),this._CONTAINER.appendChild(this._RENDERER.domElement),this._SCENE=new THREE.Scene,this._CAMERA=new THREE.PerspectiveCamera(65,this._WIDTH/this._HEIGHT,.01,1e3),this._CAMERA.position.z=.1,e()};var o=0;noise.seed(Math.random()),this.setTorusPosition=function(e,t,o){a.torus.model.position.set(e,t,o)},this.animateTorusPosition=function(e,t,o,r){TweenLite.to(a.torus.model.position,r,{x:e,y:t,z:o})},this.updateTorus=function(){var e,t,r,s,i,n,d,l=o/a.torus.frequency;if(void 0!==a.torus.model.geometry){for(var u=a.torus.initVertices,c=a.torus.model.geometry.attributes.position||[],E=0,m=c.count;m>E;E++)e=u[3*E],t=u[3*E+1],r=u[3*E+2],s=noise.simplex3(e*a.torus.amplifier,t*a.torus.amplifier,l),i=a.Utils.calcSin(e,a.Utils.checkValue(e,s)),n=a.Utils.calcSin(t,a.Utils.checkValue(t,s)),d=a.Utils.calcSin(r,a.Utils.checkValue(r,s)),c.array[3*E]=i,c.array[3*E+1]=n,c.array[3*E+2]=d;c.needsUpdate=!0}},a.updateLandscape=function(){var e,t,r,s=o/a.torus.frequency*.6;if(void 0!==a.landscape.model.geometry){for(var i=a.landscape.initVertices,n=a.landscape.model.geometry.attributes.position,d=0,l=n.count;l>d;d++)e=i[3*d],t=i[3*d+1],r=.8*noise.perlin3(e,t,s),n.array[3*d+2]=i[3*d+2]+r;n.needsUpdate=!0}},this.createTorus=function(){console.log("torus created");for(var e=new THREE.TorusBufferGeometry(a.torus.radius,a.torus.thickness,a.torus.radialSegments,a.torus.tubularSegments),t=e.attributes.position,o=0,r=t.count;r>o;o++)t.array[3*o+1]+=.02*Math.random();t.needsUpdate=!0;for(var t=e.attributes.position,o=0,r=t.array;r>o;o++)t.array[o]+=Math.random();a.torus.model=new THREE.Mesh(e,new THREE.MeshBasicMaterial({color:a.torus.color,wireframe:!0,transparent:!0,opacity:.4}));var s=new THREE.Mesh(e,new THREE.MeshBasicMaterial({color:16777215})),i=new THREE.Mesh(e,new THREE.MeshBasicMaterial({color:new THREE.Color(a.torus.color1),wireframe:!0,transparent:!0,opacity:.16})),n=new THREE.Mesh(e,new THREE.MeshBasicMaterial({color:new THREE.Color(a.torus.color2),wireframe:!0,transparent:!0,opacity:.16}));a.torus.model.position.z=a.torus.distance,a.torus.model.add(s),a.torus.model.add(i),a.torus.model.add(n),i.rotation.x=Math.PI,n.rotation.y=Math.PI,a.torus.initVertices=new Float32Array(a.torus.model.geometry.attributes.position.array),a._SCENE.add(a.torus.model)},this.removeTorus=function(){a._SCENE.remove(a.torus.model)},this.createLandscape=function(){console.log("landscape created");for(var e=64,t=new THREE.PlaneBufferGeometry(6,2,e,e),o=t.attributes.position,r=0,s=o.count;s>r;r++)o.array[3*r+2]+=.02*Math.random();o.needsUpdate=!0,a.landscape.model=new THREE.Mesh(t,new THREE.MeshBasicMaterial({color:a.torus.color,wireframe:!0,transparent:!0,opacity:.8}));var i=new THREE.Mesh(t,new THREE.MeshBasicMaterial({color:16777215,side:THREE.DoubleSide})),n=new THREE.Mesh(t,new THREE.MeshBasicMaterial({color:new THREE.Color(a.torus.color1),wireframe:!0,transparent:!0,opacity:.06})),d=new THREE.Mesh(t,new THREE.MeshBasicMaterial({color:new THREE.Color(a.torus.color2),wireframe:!0,transparent:!0,opacity:.06}));a.landscape.model.add(n),a.landscape.model.add(d),a.landscape.model.add(i),n.rotation.x=Math.PI,d.rotation.z=Math.PI,a.landscape.model.position.z=-1.6,a.landscape.model.position.y=-.8,a.landscape.model.rotation.x=Math.PI/2,a.landscape.initVertices=new Float32Array(a.landscape.model.geometry.attributes.position.array),a._SCENE.add(a.landscape.model)},this.removeLandscape=function(){a._SCENE.remove(a.landscape.model)},this.render=function(){a._RENDERER.render(this._SCENE,this._CAMERA)};return this.update=function(){o++,a.landscape.animate&&a.updateLandscape(),a.torus.animate&&a.updateTorus()},this.animate=function(){t.begin(),a.update(),a.render(),t.end(),requestAnimationFrame(a.animate)},this.bindEventListeneres=function(){window.addEventListener("resize",a.Utils.onWindowResize,!1)},this}